#!/bin/sh
set -e

VENV_DIR=".venv"
VENV_PY="$VENV_DIR/bin/python3"

# 1) Create local venv if missing
if [ ! -x "$VENV_PY" ]; then
  echo "[setup] Creating local virtualenv in $VENV_DIR…"
  python3 -m venv "$VENV_DIR"
fi

# 2) Ensure pip is present and up to date
"$VENV_PY" -m ensurepip --upgrade >/dev/null 2>&1 || true
"$VENV_PY" -m pip install --upgrade pip >/dev/null 2>&1 || true

# 3) Install/update dependencies from requirements.txt (best effort)
if [ -f requirements.txt ]; then
  echo "[setup] Installing requirements…"
  "$VENV_PY" -m pip install -r requirements.txt
fi

# 4) Run the app as a module
exec "$VENV_PY" -m quelio_cli "$@"
